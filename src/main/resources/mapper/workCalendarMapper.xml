<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="self.workCalendar" >
	
    <select id="search_tast_project_info" parameterType="java.util.Map" resultType="com.mengma.mis.self.workCalendar.entity.WorkCalendar" >
       SELECT
			tept.id AS id,
			tept.tast AS tast,
			te.employee_name AS employeeName,
			te.id AS employeeId,
			tp.start_time AS startTime,
			tp.end_time AS endTime,
			tept.project_id AS projectId,
			tept.stime AS stime,
			tept.etime AS etime
		FROM
			tbl_employee_project_task tept
		LEFT JOIN tbl_employee te ON tept.employee_id = te.id
		LEFT JOIN tbl_project tp ON tp.id = tept.project_id
			WHERE
			1=1
			and
			(tept.stime&lt;=#{fristDay})
			and
			(tept.etime&gt;=#{lastDay})
			or
			(tept.stime&lt;=#{fristDay})
			and
			(tept.etime&lt;=#{lastDay})
			and
			(tept.etime&gt;=#{fristDay})
			or
			(tept.stime&gt;=#{fristDay})
			and
			(tept.stime&gt;=#{lastDay})
			and
			(tept.etime&gt;=#{lastDay})
			or
			(tept.stime between #{fristDay}and #{lastDay})
			and
			(tept.etime between #{fristDay}and #{lastDay})
			and
		te.id=#{employeeId}
		<if test = "projectId != null and projectId !=''">
			and 
			tept.project_id =#{projectId}
			and
			(tept.stime between tp.start_time and tp.end_time)
			and
			(tept.etime between tp.start_time and tp.end_time)
		</if>
    </select>
</mapper>